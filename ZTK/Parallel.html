<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: ZTK::Parallel
  
    &mdash; Documentation by YARD 0.8.6.2
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../ZTK.html" title="ZTK (module)">ZTK</a></span></span>
     &raquo; 
    <span class="title">Parallel</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: ZTK::Parallel
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Base.html" title="ZTK::Base (class)">Base</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Base.html" title="ZTK::Base (class)">Base</a></span></li>
          
            <li class="next">ZTK::Parallel</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/ztk/parallel.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Parallel Processing Class</p>

<p>This class can be used to easily run iterative and linear processes in a parallel manner.</p>

<p>The before fork callback is called once in the parent process.</p>

<p>The after fork callback is called twice, once in the parent process and once
in the child process.</p>

<p><em>example code</em>:</p>

<pre class="code ruby"><code class="ruby"><span class='rubyid_a_callback identifier id'>a_callback</span> <span class='assign token'>=</span> <span class='rubyid_Proc constant id'>Proc</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_pid identifier id'>pid</span><span class='bitor op'>|</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Hello from After Callback - PID #{pid}&quot;</span>
<span class='rubyid_end end kw'>end</span>

<span class='rubyid_b_callback identifier id'>b_callback</span> <span class='assign token'>=</span> <span class='rubyid_Proc constant id'>Proc</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_pid identifier id'>pid</span><span class='bitor op'>|</span>
  <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Hello from Before Callback - PID #{pid}&quot;</span>
<span class='rubyid_end end kw'>end</span>

<span class='rubyid_parallel identifier id'>parallel</span> <span class='assign token'>=</span> <span class='rubyid_ZTK constant id'>ZTK</span><span class='colon2 op'>::</span><span class='rubyid_Parallel constant id'>Parallel</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
<span class='rubyid_parallel identifier id'>parallel</span><span class='dot token'>.</span><span class='rubyid_config identifier id'>config</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_config identifier id'>config</span><span class='bitor op'>|</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_before_fork identifier id'>before_fork</span> <span class='assign token'>=</span> <span class='rubyid_b_callback identifier id'>b_callback</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_after_fork identifier id'>after_fork</span> <span class='assign token'>=</span> <span class='rubyid_a_callback identifier id'>a_callback</span>
<span class='rubyid_end end kw'>end</span>

<span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_pid identifier id'>pid</span><span class='dot token'>.</span><span class='rubyid_inspect identifier id'>inspect</span>

<span class='float val'>3</span><span class='dot token'>.</span><span class='rubyid_times identifier id'>times</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_x identifier id'>x</span><span class='bitor op'>|</span>
  <span class='rubyid_parallel identifier id'>parallel</span><span class='dot token'>.</span><span class='rubyid_process identifier id'>process</span> <span class='rubyid_do do kw'>do</span>
    <span class='rubyid_x identifier id'>x</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>

<span class='rubyid_parallel identifier id'>parallel</span><span class='dot token'>.</span><span class='rubyid_waitall identifier id'>waitall</span>
<span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_parallel identifier id'>parallel</span><span class='dot token'>.</span><span class='rubyid_results identifier id'>results</span><span class='dot token'>.</span><span class='rubyid_inspect identifier id'>inspect</span>
</code></pre>

<p><em>pry output</em>:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span> <span class='rubyid_a_callback identifier id'>a_callback</span> <span class='assign token'>=</span> <span class='rubyid_Proc constant id'>Proc</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_pid identifier id'>pid</span><span class='bitor op'>|</span>
<span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span>   <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Hello from After Callback - PID #{pid}&quot;</span>
<span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span> <span class='rubyid_end end kw'>end</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='comment val'>#&lt;Proc:0x000000015a8768@(pry):1&gt;</span>
<span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span>
<span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span> <span class='rubyid_b_callback identifier id'>b_callback</span> <span class='assign token'>=</span> <span class='rubyid_Proc constant id'>Proc</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_pid identifier id'>pid</span><span class='bitor op'>|</span>
<span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span>   <span class='rubyid_puts identifier id'>puts</span> <span class='dstring node'>&quot;Hello from Before Callback - PID #{pid}&quot;</span>
<span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span> <span class='rubyid_end end kw'>end</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='comment val'>#&lt;Proc:0x000000012910e8@(pry):4&gt;</span>
<span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span>
<span class='lbrack token'>[</span><span class='integer val'>5</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span> <span class='rubyid_parallel identifier id'>parallel</span> <span class='assign token'>=</span> <span class='rubyid_ZTK constant id'>ZTK</span><span class='colon2 op'>::</span><span class='rubyid_Parallel constant id'>Parallel</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='comment val'>#&lt;ZTK::Parallel:0x000000015a9d48</span>
 <span class='rubyid_@config ivar id'>@config</span><span class='assign token'>=</span>
  <span class='comment val'>#&lt;OpenStruct stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, stderr=#&lt;IO:&lt;STDERR&gt;&gt;, stdin=#&lt;IO:&lt;STDIN&gt;&gt;, logger=#&lt;ZTK::Logger filename=&quot;/dev/null&quot;&gt;, max_forks=12&gt;,</span>
 <span class='rubyid_@forks ivar id'>@forks</span><span class='assign token'>=</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
 <span class='rubyid_@results ivar id'>@results</span><span class='assign token'>=</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='gt op'>&gt;</span>
<span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span> <span class='rubyid_parallel identifier id'>parallel</span><span class='dot token'>.</span><span class='rubyid_config identifier id'>config</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_config identifier id'>config</span><span class='bitor op'>|</span>
<span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span>   <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_before_fork identifier id'>before_fork</span> <span class='assign token'>=</span> <span class='rubyid_b_callback identifier id'>b_callback</span>
<span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span>   <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_after_fork identifier id'>after_fork</span> <span class='assign token'>=</span> <span class='rubyid_a_callback identifier id'>a_callback</span>
<span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span> <span class='rubyid_end end kw'>end</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='comment val'>#&lt;Proc:0x000000015a8768@(pry):1&gt;</span>
<span class='lbrack token'>[</span><span class='integer val'>7</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span>
<span class='lbrack token'>[</span><span class='integer val'>8</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span> <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_pid identifier id'>pid</span><span class='dot token'>.</span><span class='rubyid_inspect identifier id'>inspect</span>
<span class='integer val'>24761</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_nil nil kw'>nil</span>
<span class='lbrack token'>[</span><span class='integer val'>9</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span>
<span class='lbrack token'>[</span><span class='integer val'>10</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span> <span class='float val'>3</span><span class='dot token'>.</span><span class='rubyid_times identifier id'>times</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_x identifier id'>x</span><span class='bitor op'>|</span>
<span class='lbrack token'>[</span><span class='integer val'>10</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span>   <span class='rubyid_parallel identifier id'>parallel</span><span class='dot token'>.</span><span class='rubyid_process identifier id'>process</span> <span class='rubyid_do do kw'>do</span>
<span class='lbrack token'>[</span><span class='integer val'>10</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span>     <span class='rubyid_x identifier id'>x</span>
<span class='lbrack token'>[</span><span class='integer val'>10</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span>   <span class='rubyid_end end kw'>end</span>
<span class='lbrack token'>[</span><span class='integer val'>10</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='mult op'>*</span> <span class='rubyid_end end kw'>end</span>
<span class='rubyid_Hello constant id'>Hello</span> <span class='rubyid_from identifier id'>from</span> <span class='rubyid_Before constant id'>Before</span> <span class='rubyid_Callback constant id'>Callback</span> <span class='minus op'>-</span> <span class='rubyid_PID constant id'>PID</span> <span class='integer val'>24761</span>
<span class='rubyid_Hello constant id'>Hello</span> <span class='rubyid_from identifier id'>from</span> <span class='rubyid_After constant id'>After</span> <span class='rubyid_Callback constant id'>Callback</span> <span class='minus op'>-</span> <span class='rubyid_PID constant id'>PID</span> <span class='integer val'>24761</span>
<span class='rubyid_Hello constant id'>Hello</span> <span class='rubyid_from identifier id'>from</span> <span class='rubyid_Before constant id'>Before</span> <span class='rubyid_Callback constant id'>Callback</span> <span class='minus op'>-</span> <span class='rubyid_PID constant id'>PID</span> <span class='integer val'>24761</span>
<span class='rubyid_Hello constant id'>Hello</span> <span class='rubyid_from identifier id'>from</span> <span class='rubyid_After constant id'>After</span> <span class='rubyid_Callback constant id'>Callback</span> <span class='minus op'>-</span> <span class='rubyid_PID constant id'>PID</span> <span class='integer val'>24776</span>
<span class='rubyid_Hello constant id'>Hello</span> <span class='rubyid_from identifier id'>from</span> <span class='rubyid_After constant id'>After</span> <span class='rubyid_Callback constant id'>Callback</span> <span class='minus op'>-</span> <span class='rubyid_PID constant id'>PID</span> <span class='integer val'>24761</span>
<span class='rubyid_Hello constant id'>Hello</span> <span class='rubyid_from identifier id'>from</span> <span class='rubyid_Before constant id'>Before</span> <span class='rubyid_Callback constant id'>Callback</span> <span class='minus op'>-</span> <span class='rubyid_PID constant id'>PID</span> <span class='integer val'>24761</span>
<span class='rubyid_Hello constant id'>Hello</span> <span class='rubyid_from identifier id'>from</span> <span class='rubyid_After constant id'>After</span> <span class='rubyid_Callback constant id'>Callback</span> <span class='minus op'>-</span> <span class='rubyid_PID constant id'>PID</span> <span class='integer val'>24779</span>
<span class='rubyid_Hello constant id'>Hello</span> <span class='rubyid_from identifier id'>from</span> <span class='rubyid_After constant id'>After</span> <span class='rubyid_Callback constant id'>Callback</span> <span class='minus op'>-</span> <span class='rubyid_PID constant id'>PID</span> <span class='integer val'>24761</span>
<span class='rubyid_Hello constant id'>Hello</span> <span class='rubyid_from identifier id'>from</span> <span class='rubyid_After constant id'>After</span> <span class='rubyid_Callback constant id'>Callback</span> <span class='minus op'>-</span> <span class='rubyid_PID constant id'>PID</span> <span class='integer val'>24782</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>3</span>
<span class='lbrack token'>[</span><span class='integer val'>11</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span>
<span class='lbrack token'>[</span><span class='integer val'>12</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span> <span class='rubyid_parallel identifier id'>parallel</span><span class='dot token'>.</span><span class='rubyid_waitall identifier id'>waitall</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rbrack token'>]</span>
<span class='lbrack token'>[</span><span class='integer val'>13</span><span class='rbrack token'>]</span> <span class='rubyid_pry identifier id'>pry</span><span class='lparen token'>(</span><span class='rubyid_main identifier id'>main</span><span class='rparen token'>)</span><span class='gt op'>&gt;</span> <span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_parallel identifier id'>parallel</span><span class='dot token'>.</span><span class='rubyid_results identifier id'>results</span><span class='dot token'>.</span><span class='rubyid_inspect identifier id'>inspect</span>
<span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rbrack token'>]</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_nil nil kw'>nil</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Zachary Patten <zachary AT jovelabs DOT com></p>
</div>
      
    </li>
  
</ul>

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="MAX_FORKS-constant" class="">MAX_FORKS =
          <div class="docstring">
  <div class="discussion">
    <p>Default Maximum Number of Forks</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='rubyid_case case kw'>case</span> <span class='rubyid_RUBY_PLATFORM constant id'>RUBY_PLATFORM</span>
</pre></dd>
      
        <dt id="MAX_MEMORY-constant" class="">MAX_MEMORY =
          <div class="docstring">
  <div class="discussion">
    <p>Platforms memory capacity in bytes</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='rubyid_case case kw'>case</span> <span class='rubyid_RUBY_PLATFORM constant id'>RUBY_PLATFORM</span>
</pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#results-instance_method" title="#results (instance method)">- (Object) <strong>results</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Result Set.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count-instance_method" title="#count (instance method)">- (Integer) <strong>count</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Count of active forks.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Parallel) <strong>initialize</strong>(configuration = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of Parallel.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process-instance_method" title="#process (instance method)">- (Integer) <strong>process</strong> { ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Process in parallel.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wait-instance_method" title="#wait (instance method)">- (Array&lt;pid, status, data&gt;) <strong>wait</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Wait for a single fork to finish.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#waitall-instance_method" title="#waitall (instance method)">- (Array&lt;Object&gt;) <strong>waitall</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Waits for all forks to finish.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Base.html" title="ZTK::Base (class)">Base</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Base.html#build_config-class_method" title="ZTK::Base.build_config (method)">build_config</a></span>, <span class='object_link'><a href="Base.html#config-instance_method" title="ZTK::Base#config (method)">#config</a></span>, <span class='object_link'><a href="Base.html#direct_log-instance_method" title="ZTK::Base#direct_log (method)">#direct_log</a></span>, <span class='object_link'><a href="Base.html#log_and_raise-instance_method" title="ZTK::Base#log_and_raise (method)">#log_and_raise</a></span>, <span class='object_link'><a href="Base.html#log_and_raise-class_method" title="ZTK::Base.log_and_raise (method)">log_and_raise</a></span>, <span class='object_link'><a href="Base.html#sanitize_config-class_method" title="ZTK::Base.sanitize_config (method)">sanitize_config</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="ZTK::Parallel (class)">Parallel</a></span></tt>) <strong>initialize</strong>(configuration = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>A new instance of Parallel</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>configuration</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Configuration options hash.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a customizable set of options</p>
</div>
      
    </li>
  
</ul>

  
    
    


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


122
123
124
125
126
127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ztk/parallel.rb', line 122</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_configuration identifier id'>configuration</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_super super kw'>super</span><span class='lparen token'>(</span><span class='lbrace token'>{</span>
    <span class='symbol val'>:max_forks</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_MAX_FORKS constant id'>MAX_FORKS</span>
  <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='rubyid_configuration identifier id'>configuration</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;config=#{config.send(:table).inspect}&quot;</span> <span class='rbrace token'>}</span>

  <span class='lparen token'>(</span><span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_max_forks identifier id'>max_forks</span> <span class='lt op'>&lt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_log_and_raise identifier id'>log_and_raise</span><span class='lparen token'>(</span><span class='rubyid_ParallelError constant id'>ParallelError</span><span class='comma token'>,</span> <span class='string val'>&quot;max_forks must be equal to or greater than one!&quot;</span><span class='rparen token'>)</span>

  <span class='rubyid_@forks ivar id'>@forks</span> <span class='assign token'>=</span> <span class='rubyid_Array constant id'>Array</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_@results ivar id'>@results</span> <span class='assign token'>=</span> <span class='rubyid_Array constant id'>Array</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_GC constant id'>GC</span><span class='dot token'>.</span><span class='rubyid_respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:copy_on_write_friendly=</span><span class='rparen token'>)</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_GC constant id'>GC</span><span class='dot token'>.</span><span class='rubyid_copy_on_write_friendly identifier id'>copy_on_write_friendly</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="results=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="results-instance_method">
  
    - (<tt>Object</tt>) <strong>results</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Result Set</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ztk/parallel.rb', line 116</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_results identifier id'>results</span>
  <span class='rubyid_@results ivar id'>@results</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="count-instance_method">
  
    - (<tt>Integer</tt>) <strong>count</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Count of active forks.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Current number of active forks.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ztk/parallel.rb', line 219</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_count identifier id'>count</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;count(#{@forks.count})&quot;</span> <span class='rbrace token'>}</span>
  <span class='rubyid_@forks ivar id'>@forks</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process-instance_method">
  
    - (<tt>Integer</tt>) <strong>process</strong> { ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Process in parallel.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>Block should execute tasks to be performed in parallel.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Block can return any object to be marshalled back to
the parent processes result set.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Returns the pid of the child process forked.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ztk/parallel.rb', line 141</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_process identifier id'>process</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='rubyid_block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='notop op'>!</span><span class='rubyid_block_given? fid id'>block_given?</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_log_and_raise identifier id'>log_and_raise</span><span class='lparen token'>(</span><span class='rubyid_ParallelError constant id'>ParallelError</span><span class='comma token'>,</span> <span class='string val'>&quot;You must supply a block to the process method!&quot;</span><span class='rparen token'>)</span>

    <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;forks(#{@forks.inspect})&quot;</span> <span class='rbrace token'>}</span>

    <span class='rubyid_while while kw'>while</span> <span class='lparen token'>(</span><span class='rubyid_@forks ivar id'>@forks</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span> <span class='geq op'>&gt;=</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_max_forks identifier id'>max_forks</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
      <span class='rubyid_wait identifier id'>wait</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_child_reader identifier id'>child_reader</span><span class='comma token'>,</span> <span class='rubyid_parent_writer identifier id'>parent_writer</span> <span class='assign token'>=</span> <span class='rubyid_IO constant id'>IO</span><span class='dot token'>.</span><span class='rubyid_pipe identifier id'>pipe</span>
    <span class='rubyid_parent_reader identifier id'>parent_reader</span><span class='comma token'>,</span> <span class='rubyid_child_writer identifier id'>child_writer</span> <span class='assign token'>=</span> <span class='rubyid_IO constant id'>IO</span><span class='dot token'>.</span><span class='rubyid_pipe identifier id'>pipe</span>

    <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_before_fork identifier id'>before_fork</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_before_fork identifier id'>before_fork</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_pid identifier id'>pid</span><span class='rparen token'>)</span>
    <span class='rubyid_pid identifier id'>pid</span> <span class='assign token'>=</span> <span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_fork identifier id'>fork</span> <span class='rubyid_do do kw'>do</span>
      <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_after_fork identifier id'>after_fork</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_after_fork identifier id'>after_fork</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_pid identifier id'>pid</span><span class='rparen token'>)</span>

      <span class='rubyid_parent_writer identifier id'>parent_writer</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>
      <span class='rubyid_parent_reader identifier id'>parent_reader</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>

      <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rubyid_data identifier id'>data</span> <span class='assign token'>=</span> <span class='rubyid_block identifier id'>block</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
        <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;write(#{data.inspect})&quot;</span> <span class='rbrace token'>}</span>
        <span class='rubyid_child_writer identifier id'>child_writer</span><span class='dot token'>.</span><span class='rubyid_write identifier id'>write</span><span class='lparen token'>(</span><span class='rubyid_Base64 constant id'>Base64</span><span class='dot token'>.</span><span class='rubyid_encode64 identifier id'>encode64</span><span class='lparen token'>(</span><span class='rubyid_Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='rubyid_dump identifier id'>dump</span><span class='lparen token'>(</span><span class='rubyid_data identifier id'>data</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_child_reader identifier id'>child_reader</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>
      <span class='rubyid_child_writer identifier id'>child_writer</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>
      <span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_exit! fid id'>exit!</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_after_fork identifier id'>after_fork</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_after_fork identifier id'>after_fork</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_pid identifier id'>pid</span><span class='rparen token'>)</span>

    <span class='rubyid_child_reader identifier id'>child_reader</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>
    <span class='rubyid_child_writer identifier id'>child_writer</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>

    <span class='rubyid_fork identifier id'>fork</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:reader</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_parent_reader identifier id'>parent_reader</span><span class='comma token'>,</span> <span class='symbol val'>:writer</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_parent_writer identifier id'>parent_writer</span><span class='comma token'>,</span> <span class='symbol val'>:pid</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_pid identifier id'>pid</span><span class='rbrace token'>}</span>
    <span class='rubyid_@forks ivar id'>@forks</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_fork identifier id'>fork</span>

    <span class='rubyid_pid identifier id'>pid</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Wait for a single fork to finish.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># If a fork successfully finishes, it's return value from the *process*</span>
  <span class='comment val'># block is stored into the main result set.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @return [Array&lt;pid, status, data&gt;] An array containing the pid,</span>
  <span class='comment val'>#   status and data returned from the process block.  If wait2() fails nil</span>
  <span class='comment val'>#   is returned.</span>
  <span class='rubyid_def def kw'>def</span> <span class='rubyid_wait identifier id'>wait</span>
    <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='string val'>&quot;wait&quot;</span> <span class='rbrace token'>}</span>
    <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;forks(#{@forks.inspect})&quot;</span> <span class='rbrace token'>}</span>
    <span class='rubyid_pid identifier id'>pid</span><span class='comma token'>,</span> <span class='rubyid_status identifier id'>status</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_wait2 identifier id'>wait2</span><span class='lparen token'>(</span><span class='integer val'>-1</span><span class='rparen token'>)</span> <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
    <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_pid identifier id'>pid</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_status identifier id'>status</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rubyid_fork identifier id'>fork</span> <span class='assign token'>=</span> <span class='rubyid_@forks ivar id'>@forks</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_f identifier id'>f</span><span class='bitor op'>|</span> <span class='rubyid_f identifier id'>f</span><span class='lbrack token'>[</span><span class='symbol val'>:pid</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='rubyid_pid identifier id'>pid</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_first identifier id'>first</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
      <span class='rubyid_data identifier id'>data</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='rubyid_load identifier id'>load</span><span class='lparen token'>(</span><span class='rubyid_Base64 constant id'>Base64</span><span class='dot token'>.</span><span class='rubyid_decode64 identifier id'>decode64</span><span class='lparen token'>(</span><span class='rubyid_fork identifier id'>fork</span><span class='lbrack token'>[</span><span class='symbol val'>:reader</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_read identifier id'>read</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
      <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;read(#{data.inspect})&quot;</span> <span class='rbrace token'>}</span>
      <span class='notop op'>!</span><span class='rubyid_data identifier id'>data</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_@results ivar id'>@results</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_data identifier id'>data</span><span class='rparen token'>)</span>
      <span class='rubyid_fork identifier id'>fork</span><span class='lbrack token'>[</span><span class='symbol val'>:reader</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>
      <span class='rubyid_fork identifier id'>fork</span><span class='lbrack token'>[</span><span class='symbol val'>:writer</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>

      <span class='rubyid_@forks ivar id'>@forks</span> <span class='opasgn op'>-=</span> <span class='lbrack token'>[</span><span class='rubyid_fork identifier id'>fork</span><span class='rbrack token'>]</span>
      <span class='rubyid_return return kw'>return</span> <span class='lbrack token'>[</span><span class='rubyid_pid identifier id'>pid</span><span class='comma token'>,</span> <span class='rubyid_status identifier id'>status</span><span class='comma token'>,</span> <span class='rubyid_data identifier id'>data</span><span class='rbrack token'>]</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Waits for all forks to finish.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @return [Array&lt;Object&gt;] The results from all of the *process* blocks.</span>
  <span class='rubyid_def def kw'>def</span> <span class='rubyid_waitall identifier id'>waitall</span>
    <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='string val'>&quot;waitall&quot;</span> <span class='rbrace token'>}</span>
    <span class='rubyid_while while kw'>while</span> <span class='rubyid_@forks ivar id'>@forks</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_wait identifier id'>wait</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_@results ivar id'>@results</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># Count of active forks.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @return [Integer] Current number of active forks.</span>
  <span class='rubyid_def def kw'>def</span> <span class='rubyid_count identifier id'>count</span>
    <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;count(#{@forks.count})&quot;</span> <span class='rbrace token'>}</span>
    <span class='rubyid_@forks ivar id'>@forks</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span>
  <span class='rubyid_end end kw'>end</span>

<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wait-instance_method">
  
    - (<tt>Array&lt;pid, status, data&gt;</tt>) <strong>wait</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Wait for a single fork to finish.</p>

<p>If a fork successfully finishes, it&#39;s return value from the <em>process</em>
block is stored into the main result set.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;pid, status, data&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>An array containing the pid,
status and data returned from the process block.  If wait2() fails nil
is returned.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ztk/parallel.rb', line 188</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_wait identifier id'>wait</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='string val'>&quot;wait&quot;</span> <span class='rbrace token'>}</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;forks(#{@forks.inspect})&quot;</span> <span class='rbrace token'>}</span>
  <span class='rubyid_pid identifier id'>pid</span><span class='comma token'>,</span> <span class='rubyid_status identifier id'>status</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_wait2 identifier id'>wait2</span><span class='lparen token'>(</span><span class='integer val'>-1</span><span class='rparen token'>)</span> <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_pid identifier id'>pid</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_status identifier id'>status</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='rubyid_fork identifier id'>fork</span> <span class='assign token'>=</span> <span class='rubyid_@forks ivar id'>@forks</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_f identifier id'>f</span><span class='bitor op'>|</span> <span class='rubyid_f identifier id'>f</span><span class='lbrack token'>[</span><span class='symbol val'>:pid</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='rubyid_pid identifier id'>pid</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_first identifier id'>first</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
    <span class='rubyid_data identifier id'>data</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='rubyid_Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='rubyid_load identifier id'>load</span><span class='lparen token'>(</span><span class='rubyid_Base64 constant id'>Base64</span><span class='dot token'>.</span><span class='rubyid_decode64 identifier id'>decode64</span><span class='lparen token'>(</span><span class='rubyid_fork identifier id'>fork</span><span class='lbrack token'>[</span><span class='symbol val'>:reader</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_read identifier id'>read</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
    <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;read(#{data.inspect})&quot;</span> <span class='rbrace token'>}</span>
    <span class='notop op'>!</span><span class='rubyid_data identifier id'>data</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_@results ivar id'>@results</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_data identifier id'>data</span><span class='rparen token'>)</span>
    <span class='rubyid_fork identifier id'>fork</span><span class='lbrack token'>[</span><span class='symbol val'>:reader</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>
    <span class='rubyid_fork identifier id'>fork</span><span class='lbrack token'>[</span><span class='symbol val'>:writer</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>

    <span class='rubyid_@forks ivar id'>@forks</span> <span class='opasgn op'>-=</span> <span class='lbrack token'>[</span><span class='rubyid_fork identifier id'>fork</span><span class='rbrack token'>]</span>
    <span class='rubyid_return return kw'>return</span> <span class='lbrack token'>[</span><span class='rubyid_pid identifier id'>pid</span><span class='comma token'>,</span> <span class='rubyid_status identifier id'>status</span><span class='comma token'>,</span> <span class='rubyid_data identifier id'>data</span><span class='rbrack token'>]</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_nil nil kw'>nil</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="waitall-instance_method">
  
    - (<tt>Array&lt;Object&gt;</tt>) <strong>waitall</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Waits for all forks to finish.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Object&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The results from all of the <em>process</em> blocks.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


208
209
210
211
212
213
214</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ztk/parallel.rb', line 208</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_waitall identifier id'>waitall</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ui identifier id'>ui</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='string val'>&quot;waitall&quot;</span> <span class='rbrace token'>}</span>
  <span class='rubyid_while while kw'>while</span> <span class='rubyid_@forks ivar id'>@forks</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_wait identifier id'>wait</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_@results ivar id'>@results</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sun Jun 30 18:25:28 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.6.2 (ruby-1.8.7).
</div>

  </body>
</html>