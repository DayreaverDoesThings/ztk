<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: ZTK::RescueRetry
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!ZTK/RescueRetry.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../ZTK.html" title="ZTK (module)">ZTK</a></span></span>
     &raquo; 
    <span class="title">RescueRetry</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: ZTK::RescueRetry
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ZTK::RescueRetry</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/ztk/rescue_retry.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>RescueRetry Class</p>

<p>This class contains an exception handling tool, which will allowing retry
of all or specific <em>Exceptions</em> based on a set number of attempts to make.</p>

<p>The block is yielded and if a valid exception occurs the block will be
re-executed for the set number of attempts.</p>

<p><em>example code</em>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='const'>ZTK</span><span class='op'>::</span><span class='const'>RescueRetry</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:tries</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='comma'>,</span> <span class='symbol'>:on</span> <span class='op'>=&gt;</span> <span class='const'>EOFError</span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_counter'>counter</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>EOFError</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_counter'>counter</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>

<span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='const'>ZTK</span><span class='op'>::</span><span class='const'>RescueRetry</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:tries</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_counter'>counter</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OMGWTFBBQ</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_counter'>counter</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>

<span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='const'>ZTK</span><span class='op'>::</span><span class='const'>RescueRetry</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:tries</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='comma'>,</span> <span class='symbol'>:on</span> <span class='op'>=&gt;</span> <span class='const'>EOFError</span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_counter'>counter</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OMGWTFBBQ</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_counter'>counter</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
</code></pre>

<p><em>pry output</em>:</p>

<pre class="code ruby"><code class="ruby">[1] pry(main)&gt; counter = 0
=&gt; 0
[2] pry(main)&gt; ZTK::RescueRetry.try(:tries =&gt; 3, :on =&gt; EOFError) do
[2] pry(main)*   counter += 1
[2] pry(main)*   raise EOFError
[2] pry(main)* end
EOFError: EOFError
from (pry):4:in `block in &lt;main&gt;&#39;
[3] pry(main)&gt; puts counter.inspect
3
=&gt; nil
[4] pry(main)&gt;
[5] pry(main)&gt; counter = 0
=&gt; 0
[6] pry(main)&gt; ZTK::RescueRetry.try(:tries =&gt; 3) do
[6] pry(main)*   counter += 1
[6] pry(main)*   raise &quot;OMGWTFBBQ&quot;
[6] pry(main)* end
RuntimeError: OMGWTFBBQ
from (pry):10:in `block in &lt;main&gt;&#39;
[7] pry(main)&gt; puts counter.inspect
3
=&gt; nil
[8] pry(main)&gt;
[9] pry(main)&gt; counter = 0
=&gt; 0
[10] pry(main)&gt; ZTK::RescueRetry.try(:tries =&gt; 3, :on =&gt; EOFError) do
[10] pry(main)*   counter += 1
[10] pry(main)*   raise &quot;OMGWTFBBQ&quot;
[10] pry(main)* end
RuntimeError: OMGWTFBBQ
from (pry):16:in `block in &lt;main&gt;&#39;
[11] pry(main)&gt; puts counter.inspect
1
=&gt; nil
</code></pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>Zachary Patten <zachary AT jovelabs DOT com></p>
</div>
      
    </li>
  
</ul>

</div>






  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#try-class_method" title="try (class method)">+ (Object) <strong>try</strong>(options = {}) { ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Rescue and Retry the supplied block.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="try-class_method">
  
    + (<tt>Object</tt>) <strong>try</strong>(options = {}) { ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Rescue and Retry the supplied block.</p>

<p>When no options are supplied, if an <em>Exception</em> is encounter it is
surfaced immediately and no retry is performed.</p>

<p>It is advisable to at least leave the <em>delay</em> option at 1.  You could
optionally set this to 0, but this is generally a bad idea.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Configuration options hash.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:tries</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>1</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>How many attempts at executing the
block before we give up and surface the <em>Exception</em>.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:on</span>
          <span class="type">(<tt>Exception</tt>, <tt>Array&lt;Exception&gt;</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>Exception</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Watch for
specific exceptions instead of performing retry on all exceptions.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:raise</span>
          <span class="type">(<tt>Exception</tt>, <tt>Array&lt;Exception&gt;</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>Exception</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>Watch
for specific exceptions and do not attempt to retry if they are
raised.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:delay</span>
          <span class="type">(<tt>Float</tt>, <tt>Integer</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>1</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>How long to sleep for between
each retry.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:on_retry</span>
          <span class="type">(<tt>Lambda</tt>, <tt>Proc</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>A proc or lambda to call
when we catch an exception and retry.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>Block should execute the tasks to be rescued and retried if
needed.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The return value of the block.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ztk/rescue_retry.rb', line 106</span>

<span class='kw'>def</span> <span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_build_config'>build_config</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='symbol'>:tries</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:on</span> <span class='op'>=&gt;</span> <span class='const'>Exception</span><span class='comma'>,</span>
    <span class='symbol'>:delay</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:raise</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span>
  <span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='op'>!</span><span class='id identifier rubyid_block_given?'>block_given?</span> <span class='kw'>and</span> <span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_log_and_raise'>log_and_raise</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_ui'>ui</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span> <span class='const'>RescueRetryError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must supply a block!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raise_exceptions'>raise_exceptions</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_raise'>raise</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
  <span class='id identifier rubyid_retry_exceptions'>retry_exceptions</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_on'>on</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>

  <span class='kw'>begin</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span>

  <span class='kw'>rescue</span> <span class='op'>*</span><span class='id identifier rubyid_retry_exceptions'>retry_exceptions</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>

    <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_tries'>tries</span> <span class='op'>-=</span> <span class='int'>1</span>

    <span class='kw'>if</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_tries'>tries</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_raise_exceptions'>raise_exceptions</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_ui'>ui</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Caught </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, we will give it </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_tries'>tries</span><span class='embexpr_end'>}</span><span class='tstring_content'> more tr</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_tries'>tries</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ies</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>y</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

      <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delay'>delay</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_on_retry'>on_retry</span> <span class='kw'>and</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_on_retry'>on_retry</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span>

      <span class='kw'>retry</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_ui'>ui</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_fatal'>fatal</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Caught </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> and we have no more tries left! We have to give up now!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

      <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_e'>e</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue May 27 08:31:37 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.0).
</div>

  </body>
</html>